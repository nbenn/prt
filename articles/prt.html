<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to `prt` • prt</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to `prt`">
<meta property="og:description" content="prt">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="prt_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to <code>prt</code>
</h1>
            
      
      
      <div class="hidden name"><code>prt.Rmd</code></div>

    </div>

    
    
<p>The <code>prt</code> object introduced by this package is intended to represent tabular data stored as one or more <a href="https://www.fstpackage.org"><code>fst</code></a> files. This is in similar spirit as <a href="https://diskframe.com"><code>disk.frame</code></a>, but is much less ambitious in scope and therefore much simpler in implementation. While the <code>disk.frame</code> package attempts to provide a <a href="https://dplyr.tidyverse.org"><code>dplyr</code></a> compliant API and offers parallel computation via the <a href="https://cran.r-project.org/package=future"><code>future</code></a> package, the intended use-case for <code>prt</code> objects is the situation where only a (small) subset of rows of the (large) tabular dataset are of interest for analysis at once. This subset can be specified using the base generic function <code><a href="https://rdrr.io/r/base/subset.html">subset()</a></code> and the selected data is read into memory as a <code>data.table</code> object. Subsequent data operations and analysis is then preformed on this <code>data.table</code> representation. For this reason, partition-level parallelism is not in-scope for <code>prt</code> as <code>fst</code> already provides an efficient shared memory parallel implementation for decompression. Furthermore the much more complex multi-function non-standard evaluation API provided by <code>dplyr</code> was forgone in favor of the very simple one-function approach presented by the base R S3 generic function <code><a href="https://rdrr.io/r/base/subset.html">subset()</a></code>.</p>
<p>For the purpose of illustration of some <code>prt</code> features and particularities, we instantiate a dataset as <code>data.table</code> object and create a temporary directory which will contain the file-based data back ends.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>((<span class="kw">tmp</span>))

<span class="kw">dat</span> <span class="op">&lt;-</span> <span class="kw">data.table</span>::<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span>(<span class="kw">nycflights13</span>::<span class="kw"><a href="https://rdrr.io/pkg/nycflights13/man/flights.html">flights</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">dat</span>)
<span class="co">#&gt;         year month day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;      1: 2013     1   1      517            515         2      830</span>
<span class="co">#&gt;      2: 2013     1   1      533            529         4      850</span>
<span class="co">#&gt;      3: 2013     1   1      542            540         2      923</span>
<span class="co">#&gt;      4: 2013     1   1      544            545        -1     1004</span>
<span class="co">#&gt;      5: 2013     1   1      554            600        -6      812</span>
<span class="co">#&gt;     ---                                                          </span>
<span class="co">#&gt; 336772: 2013     9  30       NA           1455        NA       NA</span>
<span class="co">#&gt; 336773: 2013     9  30       NA           2200        NA       NA</span>
<span class="co">#&gt; 336774: 2013     9  30       NA           1210        NA       NA</span>
<span class="co">#&gt; 336775: 2013     9  30       NA           1159        NA       NA</span>
<span class="co">#&gt; 336776: 2013     9  30       NA            840        NA       NA</span>
<span class="co">#&gt;         sched_arr_time arr_delay carrier flight tailnum origin dest air_time</span>
<span class="co">#&gt;      1:            819        11      UA   1545  N14228    EWR  IAH      227</span>
<span class="co">#&gt;      2:            830        20      UA   1714  N24211    LGA  IAH      227</span>
<span class="co">#&gt;      3:            850        33      AA   1141  N619AA    JFK  MIA      160</span>
<span class="co">#&gt;      4:           1022       -18      B6    725  N804JB    JFK  BQN      183</span>
<span class="co">#&gt;      5:            837       -25      DL    461  N668DN    LGA  ATL      116</span>
<span class="co">#&gt;     ---                                                                     </span>
<span class="co">#&gt; 336772:           1634        NA      9E   3393    &lt;NA&gt;    JFK  DCA       NA</span>
<span class="co">#&gt; 336773:           2312        NA      9E   3525    &lt;NA&gt;    LGA  SYR       NA</span>
<span class="co">#&gt; 336774:           1330        NA      MQ   3461  N535MQ    LGA  BNA       NA</span>
<span class="co">#&gt; 336775:           1344        NA      MQ   3572  N511MQ    LGA  CLE       NA</span>
<span class="co">#&gt; 336776:           1020        NA      MQ   3531  N839MQ    LGA  RDU       NA</span>
<span class="co">#&gt;         distance hour minute           time_hour</span>
<span class="co">#&gt;      1:     1400    5     15 2013-01-01 05:00:00</span>
<span class="co">#&gt;      2:     1416    5     29 2013-01-01 05:00:00</span>
<span class="co">#&gt;      3:     1089    5     40 2013-01-01 05:00:00</span>
<span class="co">#&gt;      4:     1576    5     45 2013-01-01 05:00:00</span>
<span class="co">#&gt;      5:      762    6      0 2013-01-01 06:00:00</span>
<span class="co">#&gt;     ---                                         </span>
<span class="co">#&gt; 336772:      213   14     55 2013-09-30 14:00:00</span>
<span class="co">#&gt; 336773:      198   22      0 2013-09-30 22:00:00</span>
<span class="co">#&gt; 336774:      764   12     10 2013-09-30 12:00:00</span>
<span class="co">#&gt; 336775:      419   11     59 2013-09-30 11:00:00</span>
<span class="co">#&gt; 336776:      431    8     40 2013-09-30 08:00:00</span>
</pre></div>
<p>Creating a <code>prt</code> object consisting of 2 partitions can for example be done as</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
(<span class="kw">flights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_prt.html">as_prt</a></span>(<span class="kw">dat</span>, n_chunks = <span class="fl">2L</span>, dir = <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>(tmpdir = <span class="kw">tmp</span>)))
<span class="co">#&gt; Warning: `...` is not empty.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; We detected these problematic arguments:</span>
<span class="co">#&gt; * `needs_dots`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; These dots only exist to allow future extensions and should be empty.</span>
<span class="co">#&gt; Did you misspecify an argument?</span>
<span class="co">#&gt; # A prt:        336,776 × 19</span>
<span class="co">#&gt; # Partitioning: [168,388, 168,388] rows</span>
<span class="co">#&gt;          year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;         &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1        2013     1     1      517            515         2      830</span>
<span class="co">#&gt; 2        2013     1     1      533            529         4      850</span>
<span class="co">#&gt; 3        2013     1     1      542            540         2      923</span>
<span class="co">#&gt; 4        2013     1     1      544            545        -1     1004</span>
<span class="co">#&gt; 5        2013     1     1      554            600        -6      812</span>
<span class="co">#&gt; …</span>
<span class="co">#&gt; 336,772  2013     9    30       NA           1455        NA       NA</span>
<span class="co">#&gt; 336,773  2013     9    30       NA           2200        NA       NA</span>
<span class="co">#&gt; 336,774  2013     9    30       NA           1210        NA       NA</span>
<span class="co">#&gt; 336,775  2013     9    30       NA           1159        NA       NA</span>
<span class="co">#&gt; 336,776  2013     9    30       NA            840        NA       NA</span>
<span class="co">#&gt; # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span>
<span class="co">#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span>
<span class="co">#&gt; #   time_hour &lt;dttm&gt;</span>
</pre></div>
<p>This simply splits rows of <code>dat</code> into 2 equally sized groups, preserving the original row ordering and writes each group to its own <code>fst</code> file. Depending on the types of queries that are most frequently run against the data, this naive partitioning might not be optimal. While <code>fst</code> does provide random row access, row selection is only possible via index ranges. Consequently, for each partition all rows that fall into the range between the minimum and the maximum required index will be read into memory and superfluous rows are discarded. If for example the data were to be most frequently accessed by airline, the resulting data loads would be more efficient if the data was already sorted by carrier codes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">dat</span> <span class="op">&lt;-</span> <span class="kw">data.table</span>::<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">setorderv</a></span>(<span class="kw">dat</span>, <span class="st">"carrier"</span>)
<span class="kw">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw">dat</span><span class="op">$</span><span class="kw">carrier</span>)) <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">dat</span>) <span class="op">&lt;</span> <span class="fl">0.5</span>
<span class="kw">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span>(<span class="kw">dat</span>, <span class="kw">grp</span>[<span class="kw">dat</span><span class="op">$</span><span class="kw">carrier</span>])

<span class="fu"><a href="../reference/new_prt.html">as_prt</a></span>(<span class="kw">dat</span>, dir = <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>(tmpdir = <span class="kw">tmp</span>))
<span class="co">#&gt; Warning: `...` is not empty.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; We detected these problematic arguments:</span>
<span class="co">#&gt; * `needs_dots`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; These dots only exist to allow future extensions and should be empty.</span>
<span class="co">#&gt; Did you misspecify an argument?</span>
<span class="co">#&gt; # A prt:        336,776 × 19</span>
<span class="co">#&gt; # Partitioning: [182,128, 154,648] rows</span>
<span class="co">#&gt;          year month   day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;         &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1        2013     1     1      557            600        -3      709</span>
<span class="co">#&gt; 2        2013     1     1      624            630        -6      909</span>
<span class="co">#&gt; 3        2013     1     1      632            608        24      740</span>
<span class="co">#&gt; 4        2013     1     1      809            815        -6     1043</span>
<span class="co">#&gt; 5        2013     1     1      811            815        -4     1006</span>
<span class="co">#&gt; …</span>
<span class="co">#&gt; 336,772  2013     9    30     1955           2000        -5     2219</span>
<span class="co">#&gt; 336,773  2013     9    30     1956           1825        91     2208</span>
<span class="co">#&gt; 336,774  2013     9    30     2041           2045        -4     2147</span>
<span class="co">#&gt; 336,775  2013     9    30     2050           2045         5       20</span>
<span class="co">#&gt; 336,776  2013     9    30     2121           2100        21     2349</span>
<span class="co">#&gt; # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="co">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span>
<span class="co">#&gt; #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span>
<span class="co">#&gt; #   time_hour &lt;dttm&gt;</span>
</pre></div>
<p>The behavior of subsetting operations on <code>prt</code> objects is modeled after that of <a href="https://tibble.tidyverse.org"><code>tibble</code></a> objects. Columns can be extracted using <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code>, <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> (with partial matching being disallowed), or by selecting a single column with <code><a href="https://rdrr.io/r/base/Extract.html">[</a></code> and passing <code>TRUE</code> as <code>drop</code> argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">flights</span>[[<span class="fl">1L</span>]])
<span class="co">#&gt;  int [1:336776] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="kw">flights</span>[[<span class="st">"year"</span>]], <span class="kw">flights</span><span class="op">$</span><span class="kw">year</span>)
<span class="co">#&gt; [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="kw">flights</span>[[<span class="st">"year"</span>]], <span class="kw">flights</span>[, <span class="st">"year"</span>, drop = <span class="fl">TRUE</span>])
<span class="co">#&gt; [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">flights</span><span class="op">$</span><span class="kw">yea</span>)
<span class="co">#&gt; Warning in `$.prt`(flights, yea): Unknown or uninitialised column: `yea`.</span>
<span class="co">#&gt;  NULL</span>
</pre></div>
<p>If the object resulting from the subsetting operation is two-dimensional, it is returned as <code>data.table</code> object. Apart form this distinction, again the intent is to replicate <code>tibble</code> behavior. One way in which <code>tibble</code> and <code>data.frame</code> do not behave in the same way is in default coercion to lower dimensions. The default value for the <code>drop</code> argument of <code>[.data.frame</code> is <code>FALSE</code> if only one row is returned but changes to <code>TRUE</code> where the result is a single column, while it is always <code>FALSE</code> for <code>tibble</code>s. A difference in behavior between <code>data.table</code> and <code>tibble</code> (any by extension <code>prt</code>) is a missing <code>j</code> argument: in the <code>tibble</code> (and in the <code>data.frame</code>) implementation, the <code>i</code> argument is then interpreted as column specification, whereas for <code>data.frame</code>s, <code>i</code> remains a row selection.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">datasets</span>::<span class="kw"><a href="https://rdrr.io/r/datasets/mtcars.html">mtcars</a></span>[, <span class="st">"mpg"</span>]
<span class="co">#&gt;  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4</span>
<span class="co">#&gt; [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7</span>
<span class="co">#&gt; [31] 15.0 21.4</span>
<span class="kw">flights</span>[, <span class="st">"dep_time"</span>]
<span class="co">#&gt;         dep_time</span>
<span class="co">#&gt;      1:      517</span>
<span class="co">#&gt;      2:      533</span>
<span class="co">#&gt;      3:      542</span>
<span class="co">#&gt;      4:      544</span>
<span class="co">#&gt;      5:      554</span>
<span class="co">#&gt;     ---         </span>
<span class="co">#&gt; 336772:       NA</span>
<span class="co">#&gt; 336773:       NA</span>
<span class="co">#&gt; 336774:       NA</span>
<span class="co">#&gt; 336775:       NA</span>
<span class="co">#&gt; 336776:       NA</span>

<span class="kw">jan_dt</span> <span class="op">&lt;-</span> <span class="kw">flights</span>[<span class="kw">flights</span><span class="op">$</span><span class="kw">month</span> <span class="op">==</span> <span class="fl">1L</span>, ]

<span class="kw">jan_dt</span>[<span class="fl">1L</span>]
<span class="co">#&gt;    year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span>
<span class="co">#&gt; 1: 2013     1   1      517            515         2      830            819</span>
<span class="co">#&gt;    arr_delay carrier flight tailnum origin dest air_time distance hour minute</span>
<span class="co">#&gt; 1:        11      UA   1545  N14228    EWR  IAH      227     1400    5     15</span>
<span class="co">#&gt;              time_hour</span>
<span class="co">#&gt; 1: 2013-01-01 05:00:00</span>
<span class="kw">flights</span>[<span class="fl">1L</span>]
<span class="co">#&gt;         year</span>
<span class="co">#&gt;      1: 2013</span>
<span class="co">#&gt;      2: 2013</span>
<span class="co">#&gt;      3: 2013</span>
<span class="co">#&gt;      4: 2013</span>
<span class="co">#&gt;      5: 2013</span>
<span class="co">#&gt;     ---     </span>
<span class="co">#&gt; 336772: 2013</span>
<span class="co">#&gt; 336773: 2013</span>
<span class="co">#&gt; 336774: 2013</span>
<span class="co">#&gt; 336775: 2013</span>
<span class="co">#&gt; 336776: 2013</span>
</pre></div>
<p>Deviation of <code>prt</code> subsetting behavior from that of <code>tibble</code> objects is most likely unintentional and bug reports are much appreciated as github <a href="https://github.com/nbenn/prt/issues/new">issues</a>.</p>
<p>The main feature of <code>prt</code> is the ability to load only a subset of a much larger tabular dataset and a useful function for selecting rows and columns of a table in a concise manner is the base R S3 generic function <code><a href="https://rdrr.io/r/base/subset.html">subset()</a></code>. As such, a <code>prt</code> specific method is provided by this package. Using this functionality, above query for selecting all flights in January can be written as follows</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="kw">jan_dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, <span class="kw">month</span> <span class="op">==</span> <span class="fl">1L</span>))
<span class="co">#&gt; Evaluating row subsetting over the entire `prt` at once. If applicable consider the `part_safe` argument.</span>
<span class="co">#&gt; [1] TRUE</span>
</pre></div>
<p>A common problem with non-standard evaluation (NSE) is potential ambiguity. Symbols in expressions passed as <code>subset</code> and <code>select</code> arguments are first resolved in the context of the data, followed by the environment the expression was created in (the <a href="https://rlang.r-lib.org/reference/nse-defuse.html">quosure</a> environment). Expressions are evaluated using <code><a href="https://rlang.r-lib.org/reference/eval_tidy.html">rlang::eval_tidy()</a></code>, which makes possible the distinction between symbols referring to the data mask from those referring to the expression environment. This can either be achieved using the <code>.data</code> and <code>.env</code> pronouns or by <a href="https://rlang.r-lib.org/reference/nse-force.html">forcing parts of the expression</a>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">month</span> <span class="op">&lt;-</span> <span class="fl">1L</span>
<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, <span class="kw">month</span> <span class="op">==</span> <span class="kw">month</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">7L</span>)
<span class="co">#&gt; Evaluating row subsetting over the entire `prt` at once. If applicable consider the `part_safe` argument.</span>
<span class="co">#&gt;         year month day dep_time sched_dep_time dep_delay arr_time</span>
<span class="co">#&gt;      1: 2013     1   1      517            515         2      830</span>
<span class="co">#&gt;      2: 2013     1   1      533            529         4      850</span>
<span class="co">#&gt;      3: 2013     1   1      542            540         2      923</span>
<span class="co">#&gt;      4: 2013     1   1      544            545        -1     1004</span>
<span class="co">#&gt;      5: 2013     1   1      554            600        -6      812</span>
<span class="co">#&gt;     ---                                                          </span>
<span class="co">#&gt; 336772: 2013     9  30       NA           1455        NA       NA</span>
<span class="co">#&gt; 336773: 2013     9  30       NA           2200        NA       NA</span>
<span class="co">#&gt; 336774: 2013     9  30       NA           1210        NA       NA</span>
<span class="co">#&gt; 336775: 2013     9  30       NA           1159        NA       NA</span>
<span class="co">#&gt; 336776: 2013     9  30       NA            840        NA       NA</span>

<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="kw">jan_dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, <span class="kw">month</span> <span class="op">==</span> <span class="op">!</span><span class="op">!</span><span class="kw">month</span>))
<span class="co">#&gt; Evaluating row subsetting over the entire `prt` at once. If applicable consider the `part_safe` argument.</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="kw">jan_dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, <span class="kw">.env</span><span class="op">$</span><span class="kw">month</span> <span class="op">==</span> <span class="kw">.data</span><span class="op">$</span><span class="kw">month</span>))
<span class="co">#&gt; Evaluating row subsetting over the entire `prt` at once. If applicable consider the `part_safe` argument.</span>
<span class="co">#&gt; [1] TRUE</span>
</pre></div>
<p>While in the above example it is fairly clear what is happening and it should come as no surprise that the symbol <code>month</code> cannot simultaneously refer to a value in the calling environment and the name of a column in the data mask, a more subtle issue is considered in the following example. The environment which takes precedence for evaluating the <code>select</code> argument is a named list of column indices. This makes it possible for example to specify a range of columns as (and makes the behavior of <code><a href="https://rdrr.io/r/base/subset.html">subset()</a></code> being applied to a <code>prt</code> object consistent with that of a <code>data.frame</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, select = <span class="kw">year</span><span class="op">:</span><span class="kw">day</span>)
<span class="co">#&gt;         year month day</span>
<span class="co">#&gt;      1: 2013     1   1</span>
<span class="co">#&gt;      2: 2013     1   1</span>
<span class="co">#&gt;      3: 2013     1   1</span>
<span class="co">#&gt;      4: 2013     1   1</span>
<span class="co">#&gt;      5: 2013     1   1</span>
<span class="co">#&gt;     ---               </span>
<span class="co">#&gt; 336772: 2013     9  30</span>
<span class="co">#&gt; 336773: 2013     9  30</span>
<span class="co">#&gt; 336774: 2013     9  30</span>
<span class="co">#&gt; 336775: 2013     9  30</span>
<span class="co">#&gt; 336776: 2013     9  30</span>
</pre></div>
<p>Now recall that symbols that cannot be resolved in this data environment will be looked up in the calling environment. Therefore the following effect, while potentially unintuitive, can be explained. Again, the <code>.data</code> and <code>.env</code> pronouns can be used to resolve potential issues.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">sched_dep_time</span> <span class="op">&lt;-</span> <span class="st">"dep_time"</span>
<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, select = <span class="kw">sched_dep_time</span>)
<span class="co">#&gt;         sched_dep_time</span>
<span class="co">#&gt;      1:            515</span>
<span class="co">#&gt;      2:            529</span>
<span class="co">#&gt;      3:            540</span>
<span class="co">#&gt;      4:            545</span>
<span class="co">#&gt;      5:            600</span>
<span class="co">#&gt;     ---               </span>
<span class="co">#&gt; 336772:           1455</span>
<span class="co">#&gt; 336773:           2200</span>
<span class="co">#&gt; 336774:           1210</span>
<span class="co">#&gt; 336775:           1159</span>
<span class="co">#&gt; 336776:            840</span>

<span class="kw">actual_dep_time</span> <span class="op">&lt;-</span> <span class="st">"dep_time"</span>
<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, select = <span class="kw">actual_dep_time</span>)
<span class="co">#&gt;         dep_time</span>
<span class="co">#&gt;      1:      517</span>
<span class="co">#&gt;      2:      533</span>
<span class="co">#&gt;      3:      542</span>
<span class="co">#&gt;      4:      544</span>
<span class="co">#&gt;      5:      554</span>
<span class="co">#&gt;     ---         </span>
<span class="co">#&gt; 336772:       NA</span>
<span class="co">#&gt; 336773:       NA</span>
<span class="co">#&gt; 336774:       NA</span>
<span class="co">#&gt; 336775:       NA</span>
<span class="co">#&gt; 336776:       NA</span>

<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, select = <span class="kw">.env</span><span class="op">$</span><span class="kw">sched_dep_time</span>)
<span class="co">#&gt;         dep_time</span>
<span class="co">#&gt;      1:      517</span>
<span class="co">#&gt;      2:      533</span>
<span class="co">#&gt;      3:      542</span>
<span class="co">#&gt;      4:      544</span>
<span class="co">#&gt;      5:      554</span>
<span class="co">#&gt;     ---         </span>
<span class="co">#&gt; 336772:       NA</span>
<span class="co">#&gt; 336773:       NA</span>
<span class="co">#&gt; 336774:       NA</span>
<span class="co">#&gt; 336775:       NA</span>
<span class="co">#&gt; 336776:       NA</span>
<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, select = <span class="kw">.env</span><span class="op">$</span><span class="kw">actual_dep_time</span>)
<span class="co">#&gt;         dep_time</span>
<span class="co">#&gt;      1:      517</span>
<span class="co">#&gt;      2:      533</span>
<span class="co">#&gt;      3:      542</span>
<span class="co">#&gt;      4:      544</span>
<span class="co">#&gt;      5:      554</span>
<span class="co">#&gt;     ---         </span>
<span class="co">#&gt; 336772:       NA</span>
<span class="co">#&gt; 336773:       NA</span>
<span class="co">#&gt; 336774:       NA</span>
<span class="co">#&gt; 336775:       NA</span>
<span class="co">#&gt; 336776:       NA</span>

<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, select = <span class="kw">.data</span><span class="op">$</span><span class="kw">sched_dep_time</span>)
<span class="co">#&gt;         sched_dep_time</span>
<span class="co">#&gt;      1:            515</span>
<span class="co">#&gt;      2:            529</span>
<span class="co">#&gt;      3:            540</span>
<span class="co">#&gt;      4:            545</span>
<span class="co">#&gt;      5:            600</span>
<span class="co">#&gt;     ---               </span>
<span class="co">#&gt; 336772:           1455</span>
<span class="co">#&gt; 336773:           2200</span>
<span class="co">#&gt; 336774:           1210</span>
<span class="co">#&gt; 336775:           1159</span>
<span class="co">#&gt; 336776:            840</span>
<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">flights</span>, select = <span class="kw">.data</span><span class="op">$</span><span class="kw">actual_dep_time</span>)
<span class="co">#&gt; Error: Column `actual_dep_time` not found in `.data`</span>
</pre></div>
<p>By default, <code>subset</code> expressions are evaluated on partitions separately and this behavior can be modified using the <code>part_saft</code> argument, as in some scenarios this might be undesirable. Consider the following query which selects all rows where the arrival delay is larger than the mean arrival delay. Obviously an expression like this can yield different results depending on whether it is evaluated on individual partitions or over the entire data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">is_true</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">x</span>) <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">x</span>) <span class="op">&amp;</span> <span class="kw">x</span>
<span class="kw">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">quote</a></span>(<span class="fu">is_true</span>(<span class="kw">arr_delay</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">arr_delay</span>, na.rm = <span class="fl">TRUE</span>)))
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu"><a href="../reference/nse.html">subset_quo</a></span>(<span class="kw">flights</span>, <span class="kw">expr</span>))
<span class="co">#&gt; Evaluating row subsetting over the entire `prt` at once. If applicable consider the `part_safe` argument.</span>
<span class="co">#&gt; [1] 105827</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu"><a href="../reference/nse.html">subset_quo</a></span>(<span class="kw">flights</span>, <span class="kw">expr</span>, part_safe = <span class="fl">FALSE</span>))
<span class="co">#&gt; Evaluating row subsetting over the entire `prt` at once. If applicable consider the `part_safe` argument.</span>
<span class="co">#&gt; [1] 105827</span>
</pre></div>
<p>As an aside, in addition to <code><a href="https://rdrr.io/r/base/subset.html">subset()</a></code>, which creates quosures from the expressions passed as <code>subset</code> and <code>select</code>, (using <code><a href="https://rlang.r-lib.org/reference/nse-defuse.html">rlang::enquo()</a></code>) the function <code><a href="../reference/nse.html">subset_quo()</a></code> which operates on already quoted expressions is exported as well. Thanks to the double curly brace forwarding operator introduced in rlang 0.4.0, this escape-hatch mechanism however is of lesser importance.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">col_safe_subset</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">x</span>, <span class="kw">expr</span>, <span class="kw">cols</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="fu"><a href="../reference/new_prt.html">is_prt</a></span>(<span class="kw">x</span>), <span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span>(<span class="kw">cols</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">x</span>, {{ <span class="kw">expr</span> }}, <span class="kw">.env</span><span class="op">$</span><span class="kw">cols</span>)
}

<span class="kw">air_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"dep_time"</span>, <span class="st">"arr_time"</span>)
<span class="fu">col_safe_subset</span>(<span class="kw">flights</span>, <span class="kw">month</span> <span class="op">==</span> <span class="fl">1L</span>, <span class="kw">air_time</span>)
<span class="co">#&gt; Evaluating row subsetting over the entire `prt` at once. If applicable consider the `part_safe` argument.</span>
<span class="co">#&gt;        dep_time arr_time</span>
<span class="co">#&gt;     1:      517      830</span>
<span class="co">#&gt;     2:      533      850</span>
<span class="co">#&gt;     3:      542      923</span>
<span class="co">#&gt;     4:      544     1004</span>
<span class="co">#&gt;     5:      554      812</span>
<span class="co">#&gt;    ---                  </span>
<span class="co">#&gt; 27000:       NA       NA</span>
<span class="co">#&gt; 27001:       NA       NA</span>
<span class="co">#&gt; 27002:       NA       NA</span>
<span class="co">#&gt; 27003:       NA       NA</span>
<span class="co">#&gt; 27004:       NA       NA</span>
</pre></div>
<p>In addition to subsetting, concise and informative printing is another area which effort ha been put into. Inspired by (and liberally borrowing code from) <code>tibble</code>, the <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> method of <code>fst</code> objects adds the <code>data.table</code> approach of showing both the first and last <code>n</code> rows of the table in question. This functionality can be used by other classes used to represent tabular data, as the function <code><a href="../reference/trunc_dt.html">trunc_dt()</a></code> driving this is exported. All that is required are implementations of the base S3 generic functions <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code>, <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code>, <code><a href="https://rdrr.io/r/utils/head.html">tail()</a></code> and of course <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">new_tbl</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">...</span>) <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">...</span>), class = <span class="st">"my_tbl"</span>)

<span class="kw">dim.my_tbl</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">x</span>) {
  <span class="kw">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span>(<span class="kw">x</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">rows</span>) <span class="op">==</span> <span class="fl">1L</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">rows</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">x</span>))
}
<span class="kw">head.my_tbl</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">x</span>, <span class="kw">n</span> = <span class="fl">6L</span>, <span class="kw">...</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">x</span>, <span class="kw">`[`</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="kw">n</span>)))
}
<span class="kw">tail.my_tbl</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">x</span>, <span class="kw">n</span> = <span class="fl">6L</span>, <span class="kw">...</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">x</span>, <span class="kw">`[`</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">x</span>) <span class="op">-</span> <span class="kw">n</span> <span class="op">+</span> <span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">x</span>))))
}
<span class="kw">print.my_tbl</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">x</span>, <span class="kw">...</span>, <span class="kw">n</span> = <span class="kw">NULL</span>, <span class="kw">width</span> = <span class="kw">NULL</span>, <span class="kw">n_extra</span> = <span class="kw">NULL</span>) {
  <span class="kw">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="../reference/trunc_dt.html">trunc_dt</a></span>(<span class="kw">x</span>, n = <span class="kw">n</span>, width = <span class="kw">width</span>, n_extra = <span class="kw">n_extra</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">out</span>, <span class="st">"\n"</span>), sep = <span class="st">""</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="kw">x</span>)
}
</pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu">new_tbl</span>(a = <span class="kw">letters</span>, b = <span class="fl">1</span><span class="op">:</span><span class="fl">26</span>)
<span class="co">#&gt; Warning: `...` is not empty.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; We detected these problematic arguments:</span>
<span class="co">#&gt; * `needs_dots`</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; These dots only exist to allow future extensions and should be empty.</span>
<span class="co">#&gt; Did you misspecify an argument?</span>
<span class="co">#&gt; # Description: my_tbl</span>
<span class="co">#&gt;    a         b</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1  a         1</span>
<span class="co">#&gt; 2  b         2</span>
<span class="co">#&gt; 3  c         3</span>
<span class="co">#&gt; 4  d         4</span>
<span class="co">#&gt; 5  e         5</span>
<span class="co">#&gt; …     </span>
<span class="co">#&gt; 22 v        22</span>
<span class="co">#&gt; 23 w        23</span>
<span class="co">#&gt; 24 x        24</span>
<span class="co">#&gt; 25 y        25</span>
<span class="co">#&gt; 26 z        26</span>
<span class="co">#&gt; # … with 16 more rows</span>
</pre></div>
<p>Similarly, the function <code><a href="../reference/trunc_dt.html">glimpse_dt()</a></code> which can be used to implement a class-specific function for the <code>tibble</code> S3 generic <code><a href="https://tibble.tidyverse.org/reference/glimpse.html">tibble::glimpse()</a></code>. In order to customize the text description of the object a class-specific function for the <code>tibble</code> S3 generic <code><a href="https://tibble.tidyverse.org/reference/tbl_sum.html">tibble::tbl_sum()</a></code> can be provided.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span>(<span class="kw">tmp</span>, recursive = <span class="fl">TRUE</span>)
</pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicolas Bennett.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
