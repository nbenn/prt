<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to `prt` • prt</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to `prt`">
<meta property="og:description" content="prt">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/prt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nbenn/prt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to <code>prt</code>
</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nbenn/prt/blob/HEAD/vignettes/prt.Rmd" class="external-link"><code>vignettes/prt.Rmd</code></a></small>
      <div class="hidden name"><code>prt.Rmd</code></div>

    </div>

    
    
<p>The <code>prt</code> object introduced by this package is intended to
represent tabular data stored as one or more <a href="https://www.fstpackage.org" class="external-link"><code>fst</code></a> files. This is in
similar spirit as <a href="https://diskframe.com" class="external-link"><code>disk.frame</code></a>, but is much
less ambitious in scope and therefore much simpler in implementation.
While the <code>disk.frame</code> package attempts to provide a <a href="https://dplyr.tidyverse.org" class="external-link"><code>dplyr</code></a> compliant API
and offers parallel computation via the <a href="https://cran.r-project.org/package=future" class="external-link"><code>future</code></a>
package, the intended use-case for <code>prt</code> objects is the
situation where only a (small) subset of rows of the (large) tabular
dataset are of interest for analysis at once. This subset can be
specified using the base generic function <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> and the
selected data is read into memory as a <code>data.table</code> object.
Subsequent data operations and analysis is then preformed on this
<code>data.table</code> representation. For this reason, partition-level
parallelism is not in-scope for <code>prt</code> as <code>fst</code>
already provides an efficient shared memory parallel implementation for
decompression. Furthermore the much more complex multi-function
non-standard evaluation API provided by <code>dplyr</code> was forgone
in favor of the very simple one-function approach presented by the base
R S3 generic function <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code>.</p>
<p>For the purpose of illustration of some <code>prt</code> features and
particularities, we instantiate a dataset as <code>data.table</code>
object and create a temporary directory which will contain the
file-based data back ends.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu">nycflights13</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/nycflights13/man/flights.html" class="external-link">flights</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt;         year month day dep_time sched_dep_time dep_delay arr_time</span></span>
<span><span class="co">#&gt;      1: 2013     1   1      517            515         2      830</span></span>
<span><span class="co">#&gt;      2: 2013     1   1      533            529         4      850</span></span>
<span><span class="co">#&gt;      3: 2013     1   1      542            540         2      923</span></span>
<span><span class="co">#&gt;      4: 2013     1   1      544            545        -1     1004</span></span>
<span><span class="co">#&gt;      5: 2013     1   1      554            600        -6      812</span></span>
<span><span class="co">#&gt;     ---                                                          </span></span>
<span><span class="co">#&gt; 336772: 2013     9  30       NA           1455        NA       NA</span></span>
<span><span class="co">#&gt; 336773: 2013     9  30       NA           2200        NA       NA</span></span>
<span><span class="co">#&gt; 336774: 2013     9  30       NA           1210        NA       NA</span></span>
<span><span class="co">#&gt; 336775: 2013     9  30       NA           1159        NA       NA</span></span>
<span><span class="co">#&gt; 336776: 2013     9  30       NA            840        NA       NA</span></span>
<span><span class="co">#&gt;         sched_arr_time arr_delay carrier flight tailnum origin dest air_time</span></span>
<span><span class="co">#&gt;      1:            819        11      UA   1545  N14228    EWR  IAH      227</span></span>
<span><span class="co">#&gt;      2:            830        20      UA   1714  N24211    LGA  IAH      227</span></span>
<span><span class="co">#&gt;      3:            850        33      AA   1141  N619AA    JFK  MIA      160</span></span>
<span><span class="co">#&gt;      4:           1022       -18      B6    725  N804JB    JFK  BQN      183</span></span>
<span><span class="co">#&gt;      5:            837       -25      DL    461  N668DN    LGA  ATL      116</span></span>
<span><span class="co">#&gt;     ---                                                                     </span></span>
<span><span class="co">#&gt; 336772:           1634        NA      9E   3393    &lt;NA&gt;    JFK  DCA       NA</span></span>
<span><span class="co">#&gt; 336773:           2312        NA      9E   3525    &lt;NA&gt;    LGA  SYR       NA</span></span>
<span><span class="co">#&gt; 336774:           1330        NA      MQ   3461  N535MQ    LGA  BNA       NA</span></span>
<span><span class="co">#&gt; 336775:           1344        NA      MQ   3572  N511MQ    LGA  CLE       NA</span></span>
<span><span class="co">#&gt; 336776:           1020        NA      MQ   3531  N839MQ    LGA  RDU       NA</span></span>
<span><span class="co">#&gt;         distance hour minute           time_hour</span></span>
<span><span class="co">#&gt;      1:     1400    5     15 2013-01-01 05:00:00</span></span>
<span><span class="co">#&gt;      2:     1416    5     29 2013-01-01 05:00:00</span></span>
<span><span class="co">#&gt;      3:     1089    5     40 2013-01-01 05:00:00</span></span>
<span><span class="co">#&gt;      4:     1576    5     45 2013-01-01 05:00:00</span></span>
<span><span class="co">#&gt;      5:      762    6      0 2013-01-01 06:00:00</span></span>
<span><span class="co">#&gt;     ---                                         </span></span>
<span><span class="co">#&gt; 336772:      213   14     55 2013-09-30 14:00:00</span></span>
<span><span class="co">#&gt; 336773:      198   22      0 2013-09-30 22:00:00</span></span>
<span><span class="co">#&gt; 336774:      764   12     10 2013-09-30 12:00:00</span></span>
<span><span class="co">#&gt; 336775:      419   11     59 2013-09-30 11:00:00</span></span>
<span><span class="co">#&gt; 336776:      431    8     40 2013-09-30 08:00:00</span></span></code></pre></div>
<p>Creating a <code>prt</code> object consisting of 2 partitions can for
example be done as</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_prt.html">as_prt</a></span><span class="op">(</span><span class="va">dat</span>, n_chunks <span class="op">=</span> <span class="fl">2L</span>, dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>tmpdir <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A prt:        336,776 × 19</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Partitioning: [168,388, 168,388] rows</span></span></span>
<span><span class="co">#&gt;          year month   day dep_time sched_dep_time dep_delay arr_time</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1      </span>  <span style="text-decoration: underline;">2</span>013     1     1      517            515         2      830</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2      </span>  <span style="text-decoration: underline;">2</span>013     1     1      533            529         4      850</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3      </span>  <span style="text-decoration: underline;">2</span>013     1     1      542            540         2      923</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4      </span>  <span style="text-decoration: underline;">2</span>013     1     1      544            545        -<span style="color: #BB0000;">1</span>     <span style="text-decoration: underline;">1</span>004</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5      </span>  <span style="text-decoration: underline;">2</span>013     1     1      554            600        -<span style="color: #BB0000;">6</span>      812</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">…</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,772</span>  <span style="text-decoration: underline;">2</span>013     9    30       <span style="color: #BB0000;">NA</span>           <span style="text-decoration: underline;">1</span>455        <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,773</span>  <span style="text-decoration: underline;">2</span>013     9    30       <span style="color: #BB0000;">NA</span>           <span style="text-decoration: underline;">2</span>200        <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,774</span>  <span style="text-decoration: underline;">2</span>013     9    30       <span style="color: #BB0000;">NA</span>           <span style="text-decoration: underline;">1</span>210        <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,775</span>  <span style="text-decoration: underline;">2</span>013     9    30       <span style="color: #BB0000;">NA</span>           <span style="text-decoration: underline;">1</span>159        <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,776</span>  <span style="text-decoration: underline;">2</span>013     9    30       <span style="color: #BB0000;">NA</span>            840        <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 336,771 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span></span></code></pre></div>
<p>This simply splits rows of <code>dat</code> into 2 equally sized
groups, preserving the original row ordering and writes each group to
its own <code>fst</code> file. Depending on the types of queries that
are most frequently run against the data, this naive partitioning might
not be optimal. While <code>fst</code> does provide random row access,
row selection is only possible via index ranges. Consequently, for each
partition all rows that fall into the range between the minimum and the
maximum required index will be read into memory and superfluous rows are
discarded. If for example the data were to be most frequently accessed
by airline, the resulting data loads would be more efficient if the data
was already sorted by carrier codes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorderv</a></span><span class="op">(</span><span class="va">dat</span>, <span class="st">"carrier"</span><span class="op">)</span></span>
<span><span class="va">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">carrier</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.5</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">grp</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">carrier</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">by_carrier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_prt.html">as_prt</a></span><span class="op">(</span><span class="va">dat</span>, dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>tmpdir <span class="op">=</span> <span class="va">tmp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">by_carrier</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A prt:        336,776 × 19</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Partitioning: [182,128, 154,648] rows</span></span></span>
<span><span class="co">#&gt;          year month   day dep_time sched_dep_time dep_delay arr_time</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1      </span>  <span style="text-decoration: underline;">2</span>013     1     1      557            600        -<span style="color: #BB0000;">3</span>      709</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2      </span>  <span style="text-decoration: underline;">2</span>013     1     1      624            630        -<span style="color: #BB0000;">6</span>      909</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3      </span>  <span style="text-decoration: underline;">2</span>013     1     1      632            608        24      740</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4      </span>  <span style="text-decoration: underline;">2</span>013     1     1      809            815        -<span style="color: #BB0000;">6</span>     <span style="text-decoration: underline;">1</span>043</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5      </span>  <span style="text-decoration: underline;">2</span>013     1     1      811            815        -<span style="color: #BB0000;">4</span>     <span style="text-decoration: underline;">1</span>006</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">…</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,772</span>  <span style="text-decoration: underline;">2</span>013     9    30     <span style="text-decoration: underline;">1</span>955           <span style="text-decoration: underline;">2</span>000        -<span style="color: #BB0000;">5</span>     <span style="text-decoration: underline;">2</span>219</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,773</span>  <span style="text-decoration: underline;">2</span>013     9    30     <span style="text-decoration: underline;">1</span>956           <span style="text-decoration: underline;">1</span>825        91     <span style="text-decoration: underline;">2</span>208</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,774</span>  <span style="text-decoration: underline;">2</span>013     9    30     <span style="text-decoration: underline;">2</span>041           <span style="text-decoration: underline;">2</span>045        -<span style="color: #BB0000;">4</span>     <span style="text-decoration: underline;">2</span>147</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,775</span>  <span style="text-decoration: underline;">2</span>013     9    30     <span style="text-decoration: underline;">2</span>050           <span style="text-decoration: underline;">2</span>045         5       20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">336,776</span>  <span style="text-decoration: underline;">2</span>013     9    30     <span style="text-decoration: underline;">2</span>121           <span style="text-decoration: underline;">2</span>100        21     <span style="text-decoration: underline;">2</span>349</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 336,771 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span></span></code></pre></div>
<p>The behavior of subsetting operations on <code>prt</code> objects is
modeled after that of <a href="https://tibble.tidyverse.org" class="external-link"><code>tibble</code></a> objects.
Columns can be extracted using <code>[[</code>, <code>$</code> (with
partial matching being disallowed), or by selecting a single column with
<code>[</code> and passing <code>TRUE</code> as <code>drop</code>
argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">flights</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  int [1:336776] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">flights</span><span class="op">[[</span><span class="st">"year"</span><span class="op">]</span><span class="op">]</span>, <span class="va">flights</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">flights</span><span class="op">[[</span><span class="st">"year"</span><span class="op">]</span><span class="op">]</span>, <span class="va">flights</span><span class="op">[</span>, <span class="st">"year"</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">flights</span><span class="op">$</span><span class="va">yea</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Unknown or uninitialised column: `yea`.</span></span>
<span><span class="co">#&gt;  NULL</span></span></code></pre></div>
<p>If the object resulting from the subsetting operation is
two-dimensional, it is returned as <code>data.table</code> object. Apart
form this distinction, again the intent is to replicate
<code>tibble</code> behavior. One way in which <code>tibble</code> and
<code>data.frame</code> do not behave in the same way is in default
coercion to lower dimensions. The default value for the
<code>drop</code> argument of <code>[.data.frame</code> is
<code>FALSE</code> if only one row is returned but changes to
<code>TRUE</code> where the result is a single column, while it is
always <code>FALSE</code> for <code>tibble</code>s. A difference in
behavior between <code>data.table</code> and <code>tibble</code> (any by
extension <code>prt</code>) is a missing <code>j</code> argument: in the
<code>tibble</code> (and in the <code>data.frame</code>) implementation,
the <code>i</code> argument is then interpreted as column specification,
whereas for <code>data.frame</code>s, <code>i</code> remains a row
selection.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/mtcars.html" class="external-link">mtcars</a></span><span class="op">[</span>, <span class="st">"mpg"</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4</span></span>
<span><span class="co">#&gt; [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7</span></span>
<span><span class="co">#&gt; [31] 15.0 21.4</span></span>
<span><span class="va">flights</span><span class="op">[</span>, <span class="st">"dep_time"</span><span class="op">]</span></span>
<span><span class="co">#&gt;         dep_time</span></span>
<span><span class="co">#&gt;      1:      517</span></span>
<span><span class="co">#&gt;      2:      533</span></span>
<span><span class="co">#&gt;      3:      542</span></span>
<span><span class="co">#&gt;      4:      544</span></span>
<span><span class="co">#&gt;      5:      554</span></span>
<span><span class="co">#&gt;     ---         </span></span>
<span><span class="co">#&gt; 336772:       NA</span></span>
<span><span class="co">#&gt; 336773:       NA</span></span>
<span><span class="co">#&gt; 336774:       NA</span></span>
<span><span class="co">#&gt; 336775:       NA</span></span>
<span><span class="co">#&gt; 336776:       NA</span></span>
<span></span>
<span><span class="va">jan_dt</span> <span class="op">&lt;-</span> <span class="va">flights</span><span class="op">[</span><span class="va">flights</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="fl">1L</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">jan_dt</span><span class="op">[</span><span class="fl">1L</span><span class="op">]</span></span>
<span><span class="co">#&gt;    year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></span>
<span><span class="co">#&gt; 1: 2013     1   1      517            515         2      830            819</span></span>
<span><span class="co">#&gt;    arr_delay carrier flight tailnum origin dest air_time distance hour minute</span></span>
<span><span class="co">#&gt; 1:        11      UA   1545  N14228    EWR  IAH      227     1400    5     15</span></span>
<span><span class="co">#&gt;              time_hour</span></span>
<span><span class="co">#&gt; 1: 2013-01-01 05:00:00</span></span>
<span><span class="va">flights</span><span class="op">[</span><span class="fl">1L</span><span class="op">]</span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt;      1: 2013</span></span>
<span><span class="co">#&gt;      2: 2013</span></span>
<span><span class="co">#&gt;      3: 2013</span></span>
<span><span class="co">#&gt;      4: 2013</span></span>
<span><span class="co">#&gt;      5: 2013</span></span>
<span><span class="co">#&gt;     ---     </span></span>
<span><span class="co">#&gt; 336772: 2013</span></span>
<span><span class="co">#&gt; 336773: 2013</span></span>
<span><span class="co">#&gt; 336774: 2013</span></span>
<span><span class="co">#&gt; 336775: 2013</span></span>
<span><span class="co">#&gt; 336776: 2013</span></span></code></pre></div>
<p>Deviation of <code>prt</code> subsetting behavior from that of
<code>tibble</code> objects is most likely unintentional and bug reports
are much appreciated as github <a href="https://github.com/nbenn/prt/issues/new" class="external-link">issues</a>.</p>
<p>The main feature of <code>prt</code> is the ability to load only a
subset of a much larger tabular dataset and a useful function for
selecting rows and columns of a table in a concise manner is the base R
S3 generic function <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code>. As such, a <code>prt</code>
specific method is provided by this package. Using this functionality,
above query for selecting all flights in January can be written as
follows</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">jan_dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">month</span> <span class="op">==</span> <span class="fl">1L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>To illustrate the importance of row-ordering consider the following
small benchmark example: we subset on the <code>carrier</code> column,
selecting only American Airlines flights. In one <code>prt</code>
object, rows are ordered by carrier whereas in the other they are not,
which will cause rows that are interleaved with those corresponding to
<code>AA</code> flights to be read and discarded.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">carrier</span> <span class="op">==</span> <span class="st">"AA"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">by_carrier</span>, <span class="va">carrier</span> <span class="op">==</span> <span class="st">"AA"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   expression                               min   median `itr/sec` mem_alloc</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> subset(flights, carrier == "AA")     114.5ms  114.5ms      8.74    56.3MB</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> subset(by_carrier, carrier == "AA")   29.2ms   32.1ms     31.4     17.7MB</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: `gc/sec` &lt;dbl&gt;</span></span></span></code></pre></div>
<p>A common problem with non-standard evaluation (NSE) is potential
ambiguity. Symbols in expressions passed as <code>subset</code> and
<code>select</code> arguments are first resolved in the context of the
data, followed by the environment the expression was created in (the <a href="https://rlang.r-lib.org/reference/topic-defuse.html" class="external-link">quosure</a>
environment). Expressions are evaluated using
<code><a href="https://rlang.r-lib.org/reference/eval_tidy.html" class="external-link">rlang::eval_tidy()</a></code>, which makes possible the distinction
between symbols referring to the data mask from those referring to the
expression environment. This can either be achieved using the
<code>.data</code> and <code>.env</code> pronouns or by <a href="https://rlang.r-lib.org/reference/topic-inject.html" class="external-link">forcing parts
of the expression</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">month</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">month</span> <span class="op">==</span> <span class="va">month</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">7L</span><span class="op">)</span></span>
<span><span class="co">#&gt;         year month day dep_time sched_dep_time dep_delay arr_time</span></span>
<span><span class="co">#&gt;      1: 2013     1   1      517            515         2      830</span></span>
<span><span class="co">#&gt;      2: 2013     1   1      533            529         4      850</span></span>
<span><span class="co">#&gt;      3: 2013     1   1      542            540         2      923</span></span>
<span><span class="co">#&gt;      4: 2013     1   1      544            545        -1     1004</span></span>
<span><span class="co">#&gt;      5: 2013     1   1      554            600        -6      812</span></span>
<span><span class="co">#&gt;     ---                                                          </span></span>
<span><span class="co">#&gt; 336772: 2013     9  30       NA           1455        NA       NA</span></span>
<span><span class="co">#&gt; 336773: 2013     9  30       NA           2200        NA       NA</span></span>
<span><span class="co">#&gt; 336774: 2013     9  30       NA           1210        NA       NA</span></span>
<span><span class="co">#&gt; 336775: 2013     9  30       NA           1159        NA       NA</span></span>
<span><span class="co">#&gt; 336776: 2013     9  30       NA            840        NA       NA</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">jan_dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">month</span> <span class="op">==</span> <span class="op">!</span><span class="op">!</span><span class="va">month</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">jan_dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">.env</span><span class="op">$</span><span class="va">month</span> <span class="op">==</span> <span class="va">.data</span><span class="op">$</span><span class="va">month</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>While in the above example it is fairly clear what is happening and
it should come as no surprise that the symbol <code>month</code> cannot
simultaneously refer to a value in the calling environment and the name
of a column in the data mask, a more subtle issue is considered in the
following example. The environment which takes precedence for evaluating
the <code>select</code> argument is a named list of column indices. This
makes it possible for example to specify a range of columns as (and
makes the behavior of <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> being applied to a
<code>prt</code> object consistent with that of a
<code>data.frame</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, select <span class="op">=</span> <span class="va">year</span><span class="op">:</span><span class="va">day</span><span class="op">)</span></span>
<span><span class="co">#&gt;         year month day</span></span>
<span><span class="co">#&gt;      1: 2013     1   1</span></span>
<span><span class="co">#&gt;      2: 2013     1   1</span></span>
<span><span class="co">#&gt;      3: 2013     1   1</span></span>
<span><span class="co">#&gt;      4: 2013     1   1</span></span>
<span><span class="co">#&gt;      5: 2013     1   1</span></span>
<span><span class="co">#&gt;     ---               </span></span>
<span><span class="co">#&gt; 336772: 2013     9  30</span></span>
<span><span class="co">#&gt; 336773: 2013     9  30</span></span>
<span><span class="co">#&gt; 336774: 2013     9  30</span></span>
<span><span class="co">#&gt; 336775: 2013     9  30</span></span>
<span><span class="co">#&gt; 336776: 2013     9  30</span></span></code></pre></div>
<p>Now recall that symbols that cannot be resolved in this data
environment will be looked up in the calling environment. Therefore the
following effect, while potentially unintuitive, can easily be
explained. Again, the <code>.data</code> and <code>.env</code> pronouns
can be used to resolve potential issues.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sched_dep_time</span> <span class="op">&lt;-</span> <span class="st">"dep_time"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, select <span class="op">=</span> <span class="va">sched_dep_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sched_dep_time"</span></span>
<span></span>
<span><span class="va">actual_dep_time</span> <span class="op">&lt;-</span> <span class="st">"dep_time"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, select <span class="op">=</span> <span class="va">actual_dep_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dep_time"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, select <span class="op">=</span> <span class="va">.env</span><span class="op">$</span><span class="va">sched_dep_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dep_time"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, select <span class="op">=</span> <span class="va">.env</span><span class="op">$</span><span class="va">actual_dep_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "dep_time"</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, select <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">sched_dep_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sched_dep_time"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">flights</span>, select <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">actual_dep_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `.data$actual_dep_time`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Column `actual_dep_time` not found in `.data`.</span></span></code></pre></div>
<p>By default, <code>subset</code> expressions have to be evaluated on
the entire dataset at once in order to be consistent with base R
<code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> for <code>data.frames</code>. Often times this is
inefficient and this behavior can be modified using the
<code>part_saft</code> argument. Consider the following query which
selects all rows where the arrival delay is larger than the mean arrival
delay. Obviously an expression like this can yield different results
depending on whether it is evaluated on individual partitions or over
the entire data. Other queries such as the one above where we threshold
on a fixed value, however can safely be evaluated on partitions
individually.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_true</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span></span>
<span><span class="va">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu">is_true</span><span class="op">(</span><span class="va">arr_delay</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">arr_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../reference/nse.html">subset_quo</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">expr</span>, part_safe <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 105827</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../reference/nse.html">subset_quo</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">expr</span>, part_safe <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 104752</span></span></code></pre></div>
<p>As an aside, in addition to <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code>, which creates
quosures from the expressions passed as <code>subset</code> and
<code>select</code>, (using <code><a href="https://rlang.r-lib.org/reference/enquo.html" class="external-link">rlang::enquo()</a></code>) the function
<code><a href="../reference/nse.html">subset_quo()</a></code> which operates on already quoted expressions
is exported as well. Thanks to the double curly brace forwarding
operator introduced in rlang 0.4.0, this escape-hatch mechanism however
is of lesser importance.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_safe_subset</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">expr</span>, <span class="va">cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="../reference/new_prt.html">is_prt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">{</span><span class="op">{</span> <span class="va">expr</span> <span class="op">}</span><span class="op">}</span>, <span class="va">.env</span><span class="op">$</span><span class="va">cols</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">air_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dep_time"</span>, <span class="st">"arr_time"</span><span class="op">)</span></span>
<span><span class="fu">col_safe_subset</span><span class="op">(</span><span class="va">flights</span>, <span class="va">month</span> <span class="op">==</span> <span class="fl">1L</span>, <span class="va">air_time</span><span class="op">)</span></span>
<span><span class="co">#&gt;        dep_time arr_time</span></span>
<span><span class="co">#&gt;     1:      517      830</span></span>
<span><span class="co">#&gt;     2:      533      850</span></span>
<span><span class="co">#&gt;     3:      542      923</span></span>
<span><span class="co">#&gt;     4:      544     1004</span></span>
<span><span class="co">#&gt;     5:      554      812</span></span>
<span><span class="co">#&gt;    ---                  </span></span>
<span><span class="co">#&gt; 27000:       NA       NA</span></span>
<span><span class="co">#&gt; 27001:       NA       NA</span></span>
<span><span class="co">#&gt; 27002:       NA       NA</span></span>
<span><span class="co">#&gt; 27003:       NA       NA</span></span>
<span><span class="co">#&gt; 27004:       NA       NA</span></span></code></pre></div>
<p>In addition to subsetting, concise and informative printing is
another area which effort ha been put into. Inspired by (and liberally
borrowing code from) <code>tibble</code>, the <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>
method of <code>fst</code> objects adds the <code>data.table</code>
approach of showing both the first and last <code>n</code> rows of the
table in question. This functionality can be used by other classes used
to represent tabular data, as the function <code><a href="../reference/formatting.html">trunc_dt()</a></code>
driving this is exported. All that is required are implementations of
the base S3 generic functions <code><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim()</a></code>, <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code>,
<code><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail()</a></code> and of course <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"my_tbl"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dim.my_tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1L</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rows</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">head.my_tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">6L</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">`[`</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">tail.my_tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">6L</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">`[`</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">print.my_tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, <span class="va">n</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">width</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                         <span class="va">max_extra_cols</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/formatting.html">format_dt</a></span><span class="op">(</span><span class="va">x</span>, n <span class="op">=</span> <span class="va">n</span>, width <span class="op">=</span> <span class="va">width</span>, max_extra_cols <span class="op">=</span> <span class="va">max_extra_cols</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">out</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">new_tbl</span><span class="op">(</span>a <span class="op">=</span> <span class="va">letters</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Description: my_tbl[,2]</span></span></span>
<span><span class="co">#&gt;    a         b</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1 </span> a         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2 </span> b         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3 </span> c         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4 </span> d         4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5 </span> e         5</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">…</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span> v        22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span> w        23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span> x        24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">25</span> y        25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">26</span> z        26</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 21 more rows</span></span></span></code></pre></div>
<p>Similarly, the function <code><a href="../reference/glimpse.html">glimpse_dt()</a></code> which can be used
to implement a class-specific function for the <code>tibble</code> S3
generic <code><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">tibble::glimpse()</a></code>. In order to customize the text
description of the object a class-specific function for the
<code>tibble</code> S3 generic <code><a href="https://pillar.r-lib.org/reference/tbl_sum.html" class="external-link">tibble::tbl_sum()</a></code> can be
provided.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">tmp</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nicolas Bennett.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
